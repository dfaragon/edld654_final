"0","debug_contr_error <- function (dat, subset_vec = NULL) {"
"0","  if (!is.null(subset_vec)) {"
"0","    ## step 0"
"0","    if (mode(subset_vec) == ""logical"") {"
"0","      if (length(subset_vec) != nrow(dat)) {"
"0","        stop(""'logical' `subset_vec` provided but length does not match `nrow(dat)`"")"
"0","        }"
"0","      subset_log_vec <- subset_vec"
"0","      } else if (mode(subset_vec) == ""numeric"") {"
"0","      ## check range"
"0","      ran <- range(subset_vec)"
"0","      if (ran[1] < 1 || ran[2] > nrow(dat)) {"
"0","        stop(""'numeric' `subset_vec` provided but values are out of bound"")"
"0","        } else {"
"0","        subset_log_vec <- logical(nrow(dat))"
"0","        subset_log_vec[as.integer(subset_vec)] <- TRUE"
"0","        } "
"0","      } else {"
"0","      stop(""`subset_vec` must be either 'logical' or 'numeric'"")"
"0","      }"
"0","    dat <- base::subset(dat, subset = subset_log_vec)"
"0","    } else {"
"0","    ## step 1"
"0","    dat <- stats::na.omit(dat)"
"0","    }"
"0","  if (nrow(dat) == 0L) warning(""no complete cases"")"
"0","  ## step 2"
"0","  var_mode <- sapply(dat, mode)"
"0","  if (any(var_mode %in% c(""complex"", ""raw""))) stop(""complex or raw not allowed!"")"
"0","  var_class <- sapply(dat, class)"
"0","  if (any(var_mode[var_class == ""AsIs""] %in% c(""logical"", ""character""))) {"
"0","    stop(""matrix variables with 'AsIs' class must be 'numeric'"")"
"0","    }"
"0","  ind1 <- which(var_mode %in% c(""logical"", ""character""))"
"0","  dat[ind1] <- lapply(dat[ind1], as.factor)"
"0","  ## step 3"
"0","  fctr <- which(sapply(dat, is.factor))"
"0","  if (length(fctr) == 0L) warning(""no factor variables to summary"")"
"0","  ind2 <- if (length(ind1) > 0L) fctr[-ind1] else fctr"
"0","  dat[ind2] <- lapply(dat[ind2], base::droplevels.factor)"
"0","  ## step 4"
"0","  lev <- lapply(dat[fctr], base::levels.default)"
"0","  nl <- lengths(lev)"
"0","  ## return"
"0","  list(nlevels = nl, levels = lev)"
"0","  }"
